<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
맵퍼 기능 : 회원가입, 중복아이디 검색, 로그인
작성자 : 반우진
작성일 : 2025-10-17
 -->
<!-- Namespace를 통해 JAVA 클래스와 Annotation클래스와 동기 -->
<mapper namespace="common">

<!-- 회원정보 생성 -->
<insert id="join" parameterType="com.assign_manage.vo.VO_User">
	insert into user
		(id,pw,user_name,user_class,gender,user_icon,birth,tel,email)
	value
		(
		#{id},md5( #{pw} ),#{user_name}
		,#{user_class},#{gender},#{user_icon}
		,#{birth}
		<if test='tel != null and !tel.equals("")'>
			,#{tel}
		</if> 
		<if test='tel == null or tel.equals("")'>
			,null
		</if>
		,#{email}
		)
</insert>

<!-- ID, Tel, Email 중복 조회 -->
<select id="checkID" parameterType="java.lang.String"
	resultType="java.lang.Integer">
	select count(*) as total
	from user
	where id = #{id}
</select>
<select id="checkTel" parameterType="java.lang.String"
	resultType="java.lang.Integer">
	select count(*) as total
	from user
	where tel = #{tel}
</select>
<select id="checkEmail" parameterType="java.lang.String"
	resultType="java.lang.Integer">
	select count(*) as total
	from user
	where email = #{email}
</select>

<!-- 로그인 조회 -->
<select id="login" parameterType="com.assign_manage.vo.VO_User"
	resultType="com.assign_manage.vo.VO_User">		
		select * 
		from user
		where id = #{id} and pw = md5( #{pw} )
</select>

<!-- ID 찾기 -->
<select id="idFind" parameterType="com.assign_manage.vo.VO_User"
	resultType="java.lang.String">		
		select id 
		from user
		where user_name = #{user_name} and tel = #{tel}
</select>

<!-- PW 찾기 ( 하지만 보안문제로 초기화 ) -->
<update id="pwFind" parameterType="com.assign_manage.vo.VO_User">
	update user
	set pw = md5( #{pw} )
	where id = #{id}
</update>

</mapper>