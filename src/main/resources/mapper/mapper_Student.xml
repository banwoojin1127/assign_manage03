<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Namespace를 통해 JAVA 클래스와 Annotation클래스와 동기 -->
<mapper namespace="student">

	<insert id="report_insert" parameterType="com.assign_manage.vo.VO_Report">
		insert into report (id, report_note, create_date, delete_date)
		values (#{ id }, #{ report_note }, #{ create_date }, #{ delete_date })
	</insert>
	
	<update id="report_modify" parameterType="com.assign_manage.vo.VO_Report">
		update report set
		report_note = #{ report_note }
		where report_no = #{ report_no }
	</update>
	
	<select id="report_view" parameterType="java.lang.String" 
			resultType="com.assign_manage.vo.VO_Report">
		select 
			report_no, assignment_no, id, report_note, create_date,
			a.assign_name, l.lecture_name, u1.name as student_name, u2.name as teacher_name
		from report r
		join assignment a on r.assignment_no = a.assignment_no
		join lecture l on a.lecture_no = l.lecture_no
		join user u1 on r.id = u1.id
		join user u2 on l.id = u2.id
		where report_no = #{ report_no }
	</select>
	
	<insert id="file_insert" parameterType="com.assign_manage.vo.VO_File"
		useGeneratedKeys="true" keyProperty="no">
		insert into file (p_name, f_name, create_date, delete_date, file_size, extension, file_path)
		values (#{ p_name }, #{ f_name }, #{ create_date }, #{ delete_date },
		#{ file_size }, #{ extension }, #{ file_path })
	</insert>

	<update id="file_modify" parameterType="com.assign_manage.vo.VO_File">
		update file set
		p_name = #{ p_name }, f_name = #{ f_name }, file_size = #{ file_size },
		extension = #{ extension }, file_path = #{ file_path }
		where file_no = #{ file_no }
	</update>
	
	<select id="file_view" parameterType="java.lang.String" 
			resultType="com.assign_manage.vo.VO_File">
			select 
				file_no, report_no, p_name, f_name, create_date, delete_date, file_size, extension, file_path
			from file
			where file_no = #{ file_no }
	</select>
	
	<delete id="file_delete" parameterType="java.lang.String">
		delete from file
		where file_no = #{ file_no }
	</delete>
	
	<select id="feedback_view" parameterType="java.lang.String" 
			resultType="com.assign_manage.vo.VO_Feedback">
			select 
				report_no, id, feedback, score
			from feedback
			where report_no = #{ report_no }
	</select>
	
	<insert id="question_insert" parameterType="com.assign_manage.vo.VO_Question">
		insert into question (id, quest_note, create_date, delete_date)
		values (#{ id }, #{ quest_note }, #{ create_date }, #{ delete_date })
	</insert>

	<update id="question_modify" parameterType="com.assign_manage.vo.VO_Question">
		update question set
		quest_note = #{ quest_note }
		where quest_no = #{ quest_no }
	</update>
	
	<select id="question_view" parameterType="java.lang.String" 
			resultType="com.assign_manage.vo.VO_Question">
			select 
				quest_no, assign_no, id, quest_note, create_date, delete_date, u.name as name
			from question q
			join user u on q.id = u.id
			where quest_no = #{ quest_no }
	</select>
	
	<delete id="question_delete" parameterType="java.lang.String">
		delete from question
		where quest_no = #{ quest_no }
	</delete>
	
	<select id="answer_view" parameterType="java.lang.String" 
			resultType="com.assign_manage.vo.VO_Answer">
			select 
				quest_no, id, answer_note, quest_note, create_date, delete_date, u.name
			from question q
			join user u on q.id = u.id
			where quest_no = #{ quest_no }
	</select>
</mapper>